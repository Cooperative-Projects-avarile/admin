import{ah as F,r as q}from"./index-f5AIFuXe.js";var z={},C={};Object.defineProperty(C,"__esModule",{value:!0});C.FalsyValue=C.shallowEqual=void 0;const B=(e,a)=>!Array.isArray(e)||!Array.isArray(a)||e.length!==a.length?!1:e.every((n,t)=>n===a[t]);C.shallowEqual=B;class H{constructor(a){this.v=a}getValue(){return this.v}}C.FalsyValue=H;var D={},S={};Object.defineProperty(S,"__esModule",{value:!0});S.LRU=void 0;class J extends Map{constructor(a){super(),this.capacity=a}get(a){const n=super.get(a);return n!==void 0&&(this.delete(a),this.set(a,n)),n}set(a,n){if(this.get(a),super.set(a,n),this.size>this.capacity){const t=this.keys().next().value;this.delete(t)}return this}}S.LRU=J;(function(e){var a=F&&F.__awaiter||function(o,c,i,p){function O(v){return v instanceof i?v:new i(function(d){d(v)})}return new(i||(i=Promise))(function(v,d){function s(A){try{_(p.next(A))}catch(m){d(m)}}function h(A){try{_(p.throw(A))}catch(m){d(m)}}function _(A){A.done?v(A.value):O(A.value).then(s,h)}_((p=p.apply(o,c||[])).next())})};Object.defineProperty(e,"__esModule",{value:!0}),e.createAsyncController=e.DEFAULT_SINGLE_KEY=e.DEFAULT_TIMER_KEY=e.DIMENSIONS=e.cacheMap=void 0;const n=C,t=S;e.cacheMap=typeof WeakMap<"u"?new WeakMap:new Map;function u(o,c){let i=null;return function(){i&&clearTimeout(i),i=setTimeout(()=>{const O=e.cacheMap.get(o);if(!O)return;const v=Date.now();O.forEach((d,s)=>{v-d.timestamp>c&&O.delete(s)})})}}function f(o,c){const i=e.cacheMap.get(o);i&&(c?i.delete(c):i.clear())}function l(o){try{return JSON.stringify(o)}catch{return console.warn("great-async: serialize parameters failed!"),"[]"}}var r;(function(o){o[o.FUNCTION=0]="FUNCTION",o[o.PARAMETERS=1]="PARAMETERS"})(r=e.DIMENSIONS||(e.DIMENSIONS={})),e.DEFAULT_TIMER_KEY=Symbol("DEFAULT_TIMER_KEY"),e.DEFAULT_SINGLE_KEY=Symbol("DEFAULT_SINGLE_KEY");function M(o,{debounceTime:c=-1,debounceDimension:i=r.FUNCTION,ttl:p=-1,single:O=!1,singleDimension:v=r.FUNCTION,retryCount:d=0,retryStrategy:s=m=>!!m,genKeyByParams:h=l,cacheCapacity:_=-1,beforeRun:A}={}){let m=new Map,T=new Map;const Y=u(b,p);let N=[];function P(R,g=0){return a(this,void 0,void 0,function*(){try{return yield o(...R)}catch(L){if(g>0&&s(L))return P(R,g-1);throw L}})}function b(...R){const g=h(R);if(p!==-1){Y();const y=e.cacheMap.get(b),E=y==null?void 0:y.get(g);if(E&&Date.now()-E.timestamp<p)return Promise.resolve(E.data)}if(_!==-1){const y=e.cacheMap.get(b),E=y==null?void 0:y.get(g);if(E)return Promise.resolve(E.data)}if(O&&c===-1){if(v===r.FUNCTION&&T.get(e.DEFAULT_SINGLE_KEY))return T.get(e.DEFAULT_SINGLE_KEY);if(v===r.PARAMETERS&&T.get(g))return T.get(g)}const L=new Promise((y,E)=>{if(c===-1)return y();N.push({resolve:y,reject:E}),i===r.FUNCTION&&(clearTimeout(m.get(e.DEFAULT_TIMER_KEY)),m.set(e.DEFAULT_TIMER_KEY,setTimeout(y,c))),i===r.PARAMETERS&&(clearTimeout(m.get(g)),m.set(g,setTimeout(y,c)))}).then(y=>y===void 0?(A==null||A(),P(R,d).then(E=>{var U;const I=e.cacheMap.get(b);return I&&(p!==-1||_!==-1)&&((U=I.get(g))===null||U===void 0?void 0:U.data)!==E&&I.set(g,{data:E,timestamp:Date.now()}),N.forEach(V=>{V.resolve(E||new n.FalsyValue(E))}),E}).catch(E=>{throw N.forEach(U=>{U.reject(E)}),E})):y instanceof n.FalsyValue?y.getValue():y).finally(()=>{m.delete(e.DEFAULT_TIMER_KEY),m.delete(g),T.delete(e.DEFAULT_SINGLE_KEY),T.delete(g),N=[]});return v===r.FUNCTION?T.set(e.DEFAULT_SINGLE_KEY,L):T.set(g,L),L}e.cacheMap.set(b,_===-1?new Map:new t.LRU(_));function G(...R){f(b,R.length?h(R):void 0)}return b.clearCache=G,b}e.createAsyncController=M})(D);var j={},W=F&&F.__awaiter||function(e,a,n,t){function u(f){return f instanceof n?f:new n(function(l){l(f)})}return new(n||(n=Promise))(function(f,l){function r(c){try{o(t.next(c))}catch(i){l(i)}}function M(c){try{o(t.throw(c))}catch(i){l(i)}}function o(c){c.done?f(c.value):u(c.value).then(r,M)}o((t=t.apply(e,a||[])).next())})},$=F&&F.__rest||function(e,a){var n={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(n[t]=e[t]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var u=0,t=Object.getOwnPropertySymbols(e);u<t.length;u++)a.indexOf(t[u])<0&&Object.prototype.propertyIsEnumerable.call(e,t[u])&&(n[t[u]]=e[t[u]]);return n};Object.defineProperty(j,"__esModule",{value:!0});j.useAsyncFunction=void 0;const Q=D,w=q,X=C,K=[],Z=(e,a={})=>{const{deps:n,manual:t,auto:u=!0}=a,f=$(a,["deps","manual","auto"]),l=(0,w.useRef)({isMounted:!1,depsRef:K,id:{}}),r=(0,w.useRef)({asyncFn:e,deps:void 0,manual:t,auto:!0}),[M]=(0,w.useState)(f),[o,c]=(0,w.useState)({loading:t===void 0?u:!t,error:null,data:null});if(r.current.asyncFn=e,r.current.manual=t,r.current.auto=u,r.current.deps=n,n&&!Array.isArray(n))throw console.log("deps:",JSON.stringify(n)),new Error("The deps must be an Array!");const i=(0,w.useMemo)(()=>{const d=(...s)=>r.current.asyncFn(...s);return(0,Q.createAsyncController)(d,Object.assign(Object.assign({},M),{beforeRun:M.debounceTime!==-1||M.beforeRun?()=>{var s;c(h=>h.loading?h:Object.assign(Object.assign({},h),{loading:!0})),(s=M.beforeRun)===null||s===void 0||s.call(M)}:void 0}))},[M]),p=(0,w.useCallback)(d=>(...s)=>W(void 0,void 0,void 0,function*(){yield Promise.resolve(),M.debounceTime===-1&&c(h=>h.loading?h:Object.assign(Object.assign({},h),{loading:!0}));try{const h=yield i(...s);return c(_=>!_.loading&&_.error===null&&_.data===h?_:{loading:!1,error:null,data:h}),h}catch(h){if(c(_=>!_.loading&&_.error===h&&_.data===null?_:{error:h,loading:!1,data:null}),d)throw h}}),[i]),O=(0,w.useMemo)(()=>p(!1),[p]),v=(0,w.useMemo)(()=>p(!0),[p]);return(0,w.useEffect)(()=>{var d;const s=r.current.deps;s!=null&&s.length&&(l.current.depsRef=s),l.current.isMounted=!0,!((d=r.current.manual)!==null&&d!==void 0?d:!u)&&O()},[O]),(0,w.useEffect)(()=>{var d;if(!l.current.isMounted||l.current.depsRef===K)return;const s=r.current.deps;(0,X.shallowEqual)(s,l.current.depsRef)||(l.current.depsRef=s,!((d=r.current.manual)!==null&&d!==void 0?d:!u)&&O())},[n,O]),{data:o.data,loading:o.loading,error:o.error,run:v,fn:v,clearCache:i.clearCache}};j.useAsyncFunction=Z;(function(e){var a=F&&F.__createBinding||(Object.create?function(t,u,f,l){l===void 0&&(l=f);var r=Object.getOwnPropertyDescriptor(u,f);(!r||("get"in r?!u.__esModule:r.writable||r.configurable))&&(r={enumerable:!0,get:function(){return u[f]}}),Object.defineProperty(t,l,r)}:function(t,u,f,l){l===void 0&&(l=f),t[l]=u[f]}),n=F&&F.__exportStar||function(t,u){for(var f in t)f!=="default"&&!Object.prototype.hasOwnProperty.call(u,f)&&a(u,t,f)};Object.defineProperty(e,"__esModule",{value:!0}),n(C,e),n(D,e),n(j,e)})(z);export{z as d};
